---
title: "Fee Schedule"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Fee Schedule}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse  = FALSE,
  echo      = TRUE,
  message   = TRUE, 
  warning   = FALSE,
  error     = TRUE,
  comment   = "#>",
  dpi       = 600, 
  out.width = "100%"
  )
```

```{r setup, message=FALSE, warning=FALSE}
library(northstar)
library(dplyr)
library(qs)
```

## Look Up HCPCS Code

```{r}
hcpcs_search(
  hcpcs = c("39503", "43116", "33935", "11646", "1164F", "V5299"), 
  state = "GA", 
  locality = "99", 
  mac = "10212")
```

# Physician Fee Schedule Amount Calculation
<br>

|          |                                                   |
|----------|---------------------------------------------------|
| $RVU_w$  | *Work* Relative Value Unit                        |
| $GPCI_w$ | *Work* Geographic Practice Cost Index             |
| $RVU_p$  | *Practice Expense* Relative Value Unit            |
| $GPCI_p$ | *Practice Expense* Geographic Practice Cost Index |
| $RVU_m$  | *Malpractice* Relative Value Unit                 |
| $GPCI_m$ | *Malpractice* Geographic Practice Cost Index      |
| $CF$     | Conversion Factor                                 |

<br>

The __Participating amount__ is calculated as follows:

<br><br>

$$x = [(RVU_w \times GPCI_w) + (RVU_p \times GPCI_p) + (RVU_m \times GPCI_m)] \times CF$$

<br>

The __Non-participating amount__ is calculated as follows:

<br>

$$ y = 0.95x$$

<br>

The __Limiting charge__ is calculated as follows:

<br>

$$ z = 0.95(1.15x)$$

<br>


```{r}
calculate_amounts(wrvu  = 6.26,
             nprvu = 7.92,
             fprvu = 4.36,
             mrvu  = 0.99,
             cf    = 32.744,
             wgpci = 1,
             pgpci = 0.883,
             mgpci = 1.125)
```

## Data Sources

```{r}
rvu(hcpcs = "11646") |> 
  glimpse()
```

```{r}
gpci(state    = "GA",
     locality = "99",
     mac      = "10212") |> 
  glimpse()
```

```{r}
pfs(hcpcs    = "11646", 
    locality = "99",
    mac      = "10212") |> 
  glimpse()
```


```{r}
descriptors(hcpcs = "11646") |> 
  tidyr::nest(clinician_descriptors = clinician_descriptor) |> 
  glimpse()
```



```{r}
level2(hcpcs = "V5299") |>   glimpse()
```

```{r}
rbcs(hcpcs = "V5299") |>   glimpse()
```

